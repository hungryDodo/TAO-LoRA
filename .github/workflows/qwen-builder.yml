name: ğŸ”¨ Qwen Builder
on:
  schedule:
    - cron: '*/15 * * * *' # æ¯15åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
  issues:
    types: [labeled]

jobs:
  build:
    if: contains(github.event.issue.labels.*.name, 'qwen-build') || github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Find Task
        id: find_task
        run: |
          # ç®€å•çš„è„šæœ¬å»æŸ¥æ‰¾å¸¦æœ‰ 'qwen-build' æ ‡ç­¾ä¸”æœªåˆ†é…çš„ Issue
          # è¾“å‡º Issue Number å’Œç›¸å…³ Spec æ–‡ä»¶è·¯å¾„

      - name: Builder Agent
        if: steps.find_task.outputs.issue_number != ''
        uses: qwenlm/qwen-code-action@v1
        with:
          qwen-token: ${{ secrets.QWEN_TOKEN }}
          model: 'qwen-2.5-coder-32b-instruct'
          task: "implement"
          prompt: |
            ä½ æ˜¯é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆã€‚
            ç›®æ ‡ï¼šè§£å†³ Issue #${{ steps.find_task.outputs.issue_number }}
            ä¾æ®ï¼šè¯·ä¸¥æ ¼éµå¾ª Spec æ–‡æ¡£ ${{ steps.find_task.outputs.spec_path }}

            æ‰§è¡Œæ­¥éª¤ï¼š
            1. ç¼–å†™/ä¿®æ”¹ä»£ç ã€‚
            2. **å¿…é¡»**ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•ã€‚
            3. è¿è¡Œæµ‹è¯•ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ©ç”¨å‰©ä½™é¢åº¦è‡ªåŠ¨ä¿®å¤ä»£ç ï¼ˆSelf-Healingï¼‰ã€‚
            4. æäº¤ PRï¼Œåˆ†æ”¯åä¸º `feat/issue-${{ steps.find_task.outputs.issue_number }}`ã€‚
